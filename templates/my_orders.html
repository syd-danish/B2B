<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Orders - Elfit Arabia</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    body { background-color: #1a2b1f; padding: 130px; color: white; }
    .section { background-color: #2a3b2f; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
    .nav-link {
  white-space: nowrap;   /* prevents line break */
  margin-left: 15px;     /* adds spacing */
}
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg fixed-top">
  <div class="container-fluid">
      <a class="navbar-brand text-white" href="{{ url_for('dashboard') }}">Elfit Arabia Client Dashboard</a>
  </div>
  <div class="d-flex">
    <ul class="navbar-nav ms-auto">
         <li class="nav-item">
    <a class="nav-link text-white" href="{{ url_for('my_messages') }}">My Messages
    {% if unread_count > 0 %}
          <span class="badge bg-danger rounded-pill ms-1">{{ unread_count }}</span>
      {% endif %}
    </a></li>
         <li class="nav-item">
      <a class="nav-link text-white active" href="{{ url_for('my_orders') }}">My Orders</a></li>
             <li class="nav-item">
    <a class="nav-link text-white" href="{{ url_for('contact_us') }}">Contact Us</a></li>
         <li class="nav-item">
    <a class="nav-link text-white" href="{{ url_for('logout') }}">Logout</a>
         </li>
     </ul>
    </div>
</nav>

<div class="content container-fluid">
  <div class="section">
    <h2 style="padding-bottom: 20px"><strong>My Orders</strong></h2>
    {% if orders %}
      <div class="list-group">
        {% for order in orders %}
        <div class="list-group-item mb-2" style="background:#3a5e46; color:white; padding-bottom: 20px">
          <div class="d-flex w-100 justify-content-between">
            <h4 class="mb-1">Order #{{order["id"]}}: {{ order["product_name"] }} ({{ order["quantity"] }})</h4>
            <small> Ordered At: {{ order["created_at"] }}</small>
          </div>
          <p class="mb-1"><strong>Expected:</strong> {{ order["expected_date"] }}</p>
          {% if order["comments"] %}
          <p class="mb-1"><strong>Comments:</strong> {{ order["comments"] }}</p>
          {% endif %}
          <h5 class="mb-1"><strong>Order Status:</strong> {{ order["status"]|capitalize }}</h5>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">You have not placed any orders yet.</p>
    {% endif %}
  </div>
</div>
<!-- Add this script before closing </body> tag -->
<script>
function checkForNewMessages() {
    fetch('/api/unread-count')
        .then(response => response.json())
        .then(data => {
            const badge = document.querySelector('.badge-notification');
            const messagesLink = document.querySelector('a[href*="my_messages"]');

            if (data.count > 0) {
                if (badge) {
                    badge.textContent = data.count;
                } else {
                    // Create new badge if it doesn't exist
                    const newBadge = document.createElement('span');
                    newBadge.className = 'badge-notification';
                    newBadge.textContent = data.count;
                    messagesLink.appendChild(newBadge);
                }

                // Optional: Show browser notification
                if (Notification.permission === 'granted') {
                    new Notification('New Message', {
                        body: `You have ${data.count} unread message(s)`,
                        icon: '/static/favicon.ico' // Add your icon path
                    });
                }
            } else {
                // Remove badge if no unread messages
                if (badge) {
                    badge.remove();
                }
            }
        })
        .catch(error => console.error('Error checking messages:', error));
}
// Request notification permission
if ('Notification' in window && Notification.permission === 'default') {
    Notification.requestPermission();
}
setInterval(checkForNewMessages, 30000);
document.addEventListener('DOMContentLoaded', checkForNewMessages);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>